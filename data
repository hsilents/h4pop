import xlwt
import pymysql
class MYSQL:
  def __init__(self):
    pass
  def __del__(self):
    self._cursor.close()
    self._connect.close()
  def connectDB(self):
    """
    Link database
    :return:
    """
    try:
      self._connect = pymysql.Connect(
        host='localhost', # Database address/server address
        port=3306, # port
        user='test', #database username
        passwd='123456',
        db='test', # Database name
        charset='utf8' # Character Encoding
      )
      return 0
    except:
      return -1
  def export(self, table_name, output_path):
    self._cursor = self._connect.cursor()
    count = self._cursor.execute('select * from '+ table_name)
    # print(self._cursor.lastrowid)
    print(count)
    # Reset cursor position
    self._cursor.scroll(0, mode='absolute')
    # Search all results
    results = self._cursor.fetchall()
    # Get the name of the data field in MYSQL
    fields = self._cursor.description
    workbook = xlwt.Workbook()
    # Note: When add_sheet, set the parameter cell_overwrite_ok=True to overwrite the data in the original cell.
    # cell_overwrite_ok defaults to False, if overwritten, an exception will be thrown.
    sheet = workbook.add_sheet('table_'+table_name, cell_overwrite_ok=True)
    # Write field information
    for field in range(0, len(fields)):
      sheet.write(0, field, fields[field][0])
    # Get and write data segment information
    row = 1
    col = 0
    for row in range(1,len(results)+1):
      for col in range(0, len(fields)):
        sheet.write(row, col, u'%s' % results[row-1][col])
    workbook.save(output_path)
if __name__ == '__main__':
  mysql = MYSQL()
  flag = mysql.connectDB()
  if flag == -1:
    print('Database connection failed')
  else:
    print('Database connection succeeded')
    mysql.export('test_table', 'X:\Desktop\test.xlsx')
    #      Database table name      target location
